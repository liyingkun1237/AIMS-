## 4.2 CcxRF

#### CcxRF随机森林算法原理

​	随机森林（Random Forest）是一种以CART树为基学习器的集成学习算法，它包含多个由Bagging集成学习方法训练得到的基学习器，最终的分类结果由每个基学习器的分类结果进行投票决定。随机森林的两大随机化思想体现在Bagging集成方法和特征子集上：（1）Bagging集成：从原始训练样本集N中有放回地随机抽取k个与原样本集同样大小的训练样本集合，每一个训练样本集构造一个CART基学习器，所有的k个基学习器组成随机森林；（2）特征子集：在对CART基学习器的每一个结点进行分裂时，从全部特征中等概率选取一个特征子集，再从这个子集中选出最优分裂特征；随机森林在构建各个基学习器的训练是相互独立的，因此随机森林的训练可以通过并行处理来实现，这将大大提高生成模型的效率。以下为随机森林的算法流程：输入为样本集D=(x1，y1)，(x2，y2)，…(xm，ym)，弱分类器迭代次数T。

输出为最终的强分类器f(x)：

1）对于t=1，2，…，T：

· 对训练集进行第t次随机采样，共采集m次，得到包含m个样本的采样集D_m

· 用采样集D_m训练第t个决策树模型G_m(x)，在训练决策树模型的结点的时候，在结点上所有的样本特征中选择一部分样本特征，在这些随机选择的部分样本特征中选择一个最优的特征来做决策树的左右子树划分

2）如果是分类算法预测，则T个基学习器投出最多票数的类别或者类别之一为最终类别。如果是回归算法，T个基学习器得到的回归结果进行算术平均得到的值为最终的模型输出。

#### CcxRF使用建议

- 对于样本量少特征数多的数据集，可采用随机森林算法得到较好的效果。

- 随机森林算法训练速度快，准确性较好，且不需要复杂的调参过程，在问题分析初期能够高效地得到建模探索结果。

- 随机森林的入模变量应选择相关性弱的变量，以保证基学习器之间的差异性，使得模型具有较好的泛化能力。

- 随机森林在对缺失数据进行估计时也十分有效。就算存在大量的数据缺失，随机森林也能较好地保持精确性。

#### CcxRF模型超参数设置

- **数据划分**：系统提供了分层抽样和随机抽样两种数据划分方法

- **测试集比例**：用于分配模型训练中训练样本与测试样本的比例
  - **max_depth**：万象智模平台默认值是”None”，表示决策树在建立子树的时候不会限制子树的深度。树的最大深度取值越大，对数据集的拟合效果越好，但也会使模型学到更具体更局部的样本，导致出现过拟合。数据少或者特征少的时候可以不管这个值。如果模型样本量多，特征也多的情况下，推荐限制这个最大深度，具体的取值取决于数据的分布，建议取值范围3-10。
  - **min_samples_leaf**：万象智模平台默认值是0.01，表示叶子结点最少的样本数为总样本的1%。取值是浮点数，代表最少样本数占样本总数的百分比。如果样本量不大，不需要管这个值。如果样本量数量级非常大，则推荐增大这个值。
  - **min_samples_split**：万象智模平台默认值是0.1，表示内部结点再划分所需最小样本数为样本数的10%，如果是浮点数，代表考虑样本数的百分比。如果样本量不大，不需要管这个值。如果样本量数量级非常大，则推荐增大这个值。
  - **n_estimators**：万象智模平台默认值为100，取值范围[1，inf]，最大的基学习器的个数取值太小，容易欠拟合，取值太大，计算量会太大，并且最大的基学习器的个数到一定的数量后，再增大其取值获得的模型提升会很小，所以一般选择一个适中的数值。
  - **max_features**：万象智模平台默认值是0.5，表示最大特征数选取50%的特征。如果是"log2"意味着划分时最多考虑log2N个特征；如果是"sqrt"或者"auto"意味着划分时最多考虑√N个特征。如果是整数，代表考虑的特征绝对数。如果是浮点数，代表考虑特征百分比，即考虑(百分比xN)取整后的特征数。其中N为样本总特征数。一般来说，如果样本特征数不多，比如小于50，我们用默认的”None”就可以了，如果特征数非常多，我们可以通过设置参数值来控制划分时考虑的最大特征数，以控制决策树的生成时间。
  - **criterion**：万象智模平台默认值为gini，表示CART树做划分时对特征的评价标准为gini指数。分类模型和回归模型的损失函数是不一样的。分类RF对应的CART分类树默认是基尼系数gini，另一个可选择的标准是信息增益entropy。回归RF对应的CART回归树默认是均方差mse，另一个可以选择的标准是绝对值差mae。

- **寻优策略**

  - **init_points**：万象智模平台默认值为2，确定寻优方式后，算法对应的模型超参数组合的初始个数。

  - **num_iter**：万象智模平台默认值为5，寻优算法的迭代次数。

- **最优选择指标**

  - **测试集auc最优**：最优模型选择标准为测试集上模型的评估指标auc最大。

  - **测试集/训练集auc综合最优**：最优模型选择标准为综合测试集和训练集上模型的评估指标auc最大。